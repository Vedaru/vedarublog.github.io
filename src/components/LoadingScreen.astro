---
// 加载画面组件 - 在页面加载完成后自动隐藏
---

<div id="loading-screen" class="fixed inset-0 z-[9999] flex items-center justify-center bg-white dark:bg-neutral-950 transition-opacity duration-500">
	<!-- 加载动画容器 -->
	<div class="flex flex-col items-center gap-8">
		<!-- 旋转加载圆 -->
		<div class="relative w-16 h-16">
			<div class="absolute inset-0 rounded-full border-4 border-neutral-200 dark:border-neutral-800"></div>
			<div class="absolute inset-0 rounded-full border-4 border-transparent border-t-[var(--primary)] border-r-[var(--primary)] animate-spin"></div>
		</div>

		<!-- 加载文本与进度百分比 -->
		<div class="flex flex-col items-center gap-1">
			<p class="text-lg font-semibold text-neutral-900 dark:text-neutral-100">加载中...</p>
			<p class="text-sm text-neutral-500 dark:text-neutral-500">正在准备精彩内容</p>
			<p id="loading-percent" class="text-xs text-neutral-500 dark:text-neutral-400">0%</p>
		</div>

		<!-- 进度条 -->
		<div class="w-56 h-2 bg-neutral-200 dark:bg-neutral-800 rounded-full overflow-hidden shadow-inner">
			<div id="loading-progress" class="h-full bg-gradient-to-r from-[var(--primary)] via-[var(--secondary)] to-[var(--primary)] rounded-full transition-[width] duration-300 ease-out" style="width:0%;background-size:200% 100%;background-position:0% 50%"></div>
		</div>
	</div>
</div>

<style>
	@keyframes gradientMove {
		0% { background-position: 0% 50%; }
		100% { background-position: 200% 50%; }
	}

	#loading-progress {
		background-size: 200% 100%;
		animation: gradientMove 2s linear infinite;
	}

	@keyframes fadeOut {
		to {
			opacity: 0;
			visibility: hidden;
		}
	}

	#loading-screen.hide {
		animation: fadeOut 0.5s ease-out forwards;
	}
</style>

<script is:inline>
	// 防止 FOUC（Flash of Unstyled Content）
	document.documentElement.style.overflow = 'hidden';
	
	// 模拟加载进度（更平滑的曲线）
	const progressBar = document.getElementById('loading-progress');
	const percentText = document.getElementById('loading-percent');
	let progress = 20;
	let lastUpdateTime = Date.now();
	let loadingStartTime = Date.now();

	const updateProgress = () => {
		const elapsed = Date.now() - loadingStartTime;
		const maxWait = 8000; // 最多等待8秒

		if (progress < 50) {
			// 前期快速增长 (20% -> 50%)
			progress += Math.random() * 15 + 5;
		} else if (progress < 80) {
			// 中期逐渐变慢 (50% -> 80%)
			progress += Math.random() * 8 + 2;
		} else {
			// 后期非常慢 (80% -> 95%)
			progress += Math.random() * 2 + 0.5;
		}

		// 防止溢出
		progress = Math.min(progress, 95);

		if (progressBar) {
			progressBar.style.width = Math.min(progress, 98) + '%';
		}
		if (percentText) {
			percentText.textContent = `${Math.round(progress)}%`;
		}

		// 如果加载超时，加快进度
		if (elapsed > maxWait && progress < 90) {
			progress = 90;
		}

		// 继续更新直到页面加载完成
		if (progress < 95) {
			lastUpdateTime = Date.now();
			setTimeout(updateProgress, 200 + Math.random() * 300);
		}
	};

	updateProgress();

	// 监听页面加载完成
	window.addEventListener('load', () => {
		// 完成进度条
		if (progressBar) {
			progressBar.style.width = '100%';
		}

		// 延迟一下以确保所有资源都加载完成
		setTimeout(() => {
			const loadingScreen = document.getElementById('loading-screen');
			if (loadingScreen) {
				loadingScreen.classList.add('hide');
				// 动画完成后移除元素，释放 overflow hidden
				setTimeout(() => {
					loadingScreen.remove();
					document.documentElement.style.overflow = '';
				}, 500);
			}
		}, 200);
	});

	// 确保 DOM 交互性强时隐藏加载屏幕
	if (document.readyState === 'complete') {
		const loadingScreen = document.getElementById('loading-screen');
		if (loadingScreen) {
			loadingScreen.classList.add('hide');
			setTimeout(() => {
				loadingScreen.remove();
				document.documentElement.style.overflow = '';
			}, 500);
		}
		if (percentText) percentText.textContent = '100%';
		if (progressBar) progressBar.style.width = '100%';
	}
</script>
