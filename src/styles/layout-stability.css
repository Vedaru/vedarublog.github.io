/**
 * 布局稳定性优化 - 减少 CLS (Cumulative Layout Shift)
 * 通过 CSS transform 替代动态 top 定位，使用 will-change 提升渲染性能
 */

/* 1. 使用 margin-top 替代 transform 以减少布局偏移 */
.main-content-stable {
    /* 预留空间，防止布局偏移 */
    min-height: 100vh;
    /* 使用 contain 隔离布局，但不包含 layout 以允许 fixed 定位元素正常工作 */
    contain: style;
    /* 启用 content-visibility 优化渲染 */
    content-visibility: auto;
    contain-intrinsic-size: 0 100vh;
}

/* 2. 为可能导致 CLS 的元素预留尺寸 */
.navbar-placeholder {
    min-height: 5.5rem;
    contain: layout style;
}

/* 3. 骨架屏样式 - 为异步加载内容提供占位 */
.skeleton-loading {
    background: linear-gradient(
        90deg,
        rgba(var(--card-bg-rgb), 0.3) 0%,
        rgba(var(--card-bg-rgb), 0.5) 50%,
        rgba(var(--card-bg-rgb), 0.3) 100%
    );
    background-size: 200% 100%;
    animation: skeleton-shimmer 1.5s ease-in-out infinite;
    border-radius: 0.5rem;
}

@keyframes skeleton-shimmer {
    0% {
        background-position: 200% 0;
    }
    100% {
        background-position: -200% 0;
    }
}

/* 4. 固定尺寸容器 - 防止内容加载时跳动 */
.fixed-height-container {
    min-height: 600px;
    contain: layout;
}

/* 5. 字体加载优化 - 已在实际 @font-face 规则中设置 font-display: swap */
/* @font-face {
    font-display: swap;
} */

/* 6. 图片容器固定比例 - 防止图片加载导致布局偏移 */
.aspect-ratio-box {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%; /* 16:9 */
    contain: layout;
}

.aspect-ratio-box > img,
.aspect-ratio-box > div {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* 7. 优化 z-index 分层 - 确保元素不会因层级变化导致重排 */
.z-layer-base {
    isolation: isolate;
}

/* 8. 内容可见性优化 - 延迟渲染屏幕外内容 */
.content-visibility-auto {
    content-visibility: auto;
    contain-intrinsic-size: 0 500px;
}

/* 9. 防止异步组件导致 CLS */
astro-island {
    display: block;
    min-height: 1px; /* 确保有最小高度 */
    contain: layout style paint;
}

/* 10. 优化侧边栏加载 */
.sidebar-stable {
    min-height: 300px;
    will-change: contents;
    contain: layout style;
}

/* 11. 减少隐藏元素影响 */
.hidden-no-layout {
    display: none !important;
    /* 确保 hidden 元素完全不占用布局空间 */
}

/* 12. Banner 区域稳定性 */
.banner-stable {
    height: var(--banner-height, 45vh);
    contain: strict;
    content-visibility: auto;
}

/* 13. 主网格布局优化 */
#main-grid {
    /* 使用 grid 的 auto-flow 确保平滑布局 */
    grid-auto-flow: dense;
    contain: layout;
}

/* 14. 减少动画引起的 CLS */
.onload-animation {
    /* 使用 opacity 而非 transform 避免布局计算 */
    animation: fade-in 0.3s ease-out forwards;
}

@keyframes fade-in {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

/* 15. TOC 固定尺寸 */
.toc-container {
    min-width: 250px;
    min-height: 200px;
    contain: layout style;
}

/* 16. 响应式断点优化 - 确保不同设备尺寸下布局稳定 */
@media (max-width: 768px) {
    .fixed-height-container {
        min-height: 400px;
    }
}

/* 17. 预加载关键资源 - 减少布局变化 */
.preload-visible {
    /* 立即可见的内容不使用 content-visibility */
    content-visibility: visible;
}

/* 18. 滚动容器优化 */
.scroll-container-stable {
    /* 使用 contain 避免影响外部布局 */
    contain: layout style paint;
    /* 启用硬件加速 */
    will-change: scroll-position;
    /* 优化滚动性能 */
    -webkit-overflow-scrolling: touch;
}

/* 19. Footer 固定最小高度 */
.footer-stable {
    min-height: 150px;
    contain: layout;
}

/* 20. 动态内容容器 */
.dynamic-content {
    /* 为动态加载的内容预留空间 */
    min-height: var(--min-content-height, 300px);
    contain: layout style;
}
