/* CLS (Cumulative Layout Shift) 优化 */

/* 1. 为可能导致布局偏移的元素添加固定尺寸 */

/* Navbar 固定高度 */
#navbar {
  min-height: 72px; /* 4.5rem = 72px */
  contain: layout style;
}

/* 主内容区域优化 */
#main-grid {
  contain: layout style;
  content-visibility: auto;
}

/* 2. 避免字体加载导致的布局偏移 */
body {
  /* 使用 size-adjust 保持字体切换时的一致性 */
  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* 3. 为图片容器预留空间 */
img:not([width]):not([height]) {
  /* 为没有明确尺寸的图片设置默认宽高比 */
  aspect-ratio: attr(width) / attr(height);
  height: auto;
}

/* 4. 动画和过渡优化 */
.onload-animation {
  /* 使用 transform 代替会触发 reflow 的属性 */
  will-change: transform, opacity;
  transform: translateZ(0);
}

/* 5. 侧边栏固定宽度避免偏移 */
#left-sidebar,
#right-sidebar {
  contain: layout size style;
}

/* 6. 卡片容器优化 */
.card-base {
  contain: layout style;
  /* 避免内容加载时的布局跳动 */
  min-height: fit-content;
}

/* 7. 响应式图片容器 */
.post-card-image,
.album-cover,
.anime-cover {
  position: relative;
  overflow: hidden;
  /* 强制使用 GPU 加速 */
  transform: translateZ(0);
  will-change: transform;
}

/* 8. 防止 CSS 变量未定义时的布局偏移 */
:root {
  --page-width: 75rem;
  --banner-height: 35vh;
  --banner-height-extend: 30vh;
  --banner-height-home: 65vh;
}

/* 9. 骨架屏优化（可选） */
.skeleton {
  background: linear-gradient(
    90deg,
    rgba(var(--primary-rgb), 0.05) 0%,
    rgba(var(--primary-rgb), 0.1) 50%,
    rgba(var(--primary-rgb), 0.05) 100%
  );
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}

/* 10. 减少重排的优化 */
* {
  /* 使用 border-box 避免尺寸计算导致的布局偏移 */
  box-sizing: border-box;
}

/* 11. 壁纸容器优化 */
.wallpaper-transparent {
  contain: strict;
  /* 避免背景加载时的布局跳动 */
  background-color: transparent;
}

/* 12. 导航链接容器固定高度 */
.nav-link,
.dropdown-menu {
  min-height: 44px;
  display: flex;
  align-items: center;
}

/* 13. 移动端优化 */
@media (max-width: 768px) {
  /* 移动端固定导航栏高度 */
  #navbar {
    min-height: 64px;
  }
  
  /* 移动端卡片优化 */
  .card-base {
    contain: layout;
  }
}

/* 14. 减少动画导致的布局偏移 */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* 15. 内容加载优化 */
.content-loading {
  /* 为加载中的内容预留空间 */
  min-height: 200px;
  display: flex;
  align-items: center;
  justify-content: center;
}
